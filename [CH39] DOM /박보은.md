# 39장 - DOM

### DOM

- 브라우저의 렌더링 엔진은 HTML문서를 파싱하여 브라우저가 이해할 수 있는 자료구조인 DOM을 생성
- HTML element를 제어할 수 있는 프로퍼티와 메서드를 제공
- HTML 문서의 계층적 구조와 정보를 트리 구조로 표현

## 노드

### HTML 요소와 노드 객체

- HTML 요소

![Untitled](39%E1%84%8C%E1%85%A1%E1%86%BC%20-%20DOM%20349ffdf6991640eabb4a0d36c974e0df/Untitled.png)

- HTML 요소는 렌더링 엔진에 의해 파싱되어 DOM을 구성하는 요소 노드 객체로 변환

![Untitled](39%E1%84%8C%E1%85%A1%E1%86%BC%20-%20DOM%20349ffdf6991640eabb4a0d36c974e0df/Untitled%201.png)

노드 객체들로 구성된 트리 자료구조를 **DOM**이라 한다. **DOM 트리**라고 부르기도 한다.

## 노드객체의 타입

노드 객체는 총 12개의 종류(노드 타입)가 있다. 이 중에서 중요한 노드 타입은 다음과 같이 4가지다.

- 문서노드 document node - DOM트리의 최상위에 존재하는 루트 노드, document객체
- 요소 노드 element node - HTML 요소를 가리키는 객체
- 어트리뷰트 노드 attribute node - HTML요소의 어트리뷰트를 가리키는 객체
- 텍스트 노드 text node - HTML 요소의 텍스트를 가리키는 객체

**노드 객체의 상속 구조**

- DOM을 구성하는 노드 객체는 자신의 구조와 정보를 제어할 수 있는 DOM API(프로퍼티와 메서드의 집합) 사용 가능
- DOM API를 통해 HTML의 구조나 내용 또는 스타일 등을 동적으로 조작 가능
- 노드 객체는 자신의 부모, 형제, 자식을 탐색할 수 있으며, 자신의 어트리뷰트와 텍스트를 조작할 수 있다
- DOM을 구성하는 노드 객체는 ECMAScript 사양에 정의된 표준 빌트인 객체가 아니라 브라우저 환경에서 추가적으로 제공하는 호스트 객체이다
- 노드 객체도 자바스크립트 객체이므로 프로토타입에 의한 상속 구조를 가진다
- 모든 노드 객체는 Object, EventTarget, Node 인터페이스를 상속받아 프로퍼티나 메서드 사용 가능

![Untitled](39%E1%84%8C%E1%85%A1%E1%86%BC%20-%20DOM%20349ffdf6991640eabb4a0d36c974e0df/Untitled%202.png)

## 요소 노드 취득

- HTML 구조나 내용, 스타일을 동적으로 조작하려면 요소 노드를 취득해야 한다.

### 1. id를 이용한 요소 노드 취득

- Document.prototype.getElementById 메서드로 id 어트리뷰트 값을 갖는 요소 노드 취득
- id가 존재하지 않을 경우 getELementById 메서드는 null 반환

```jsx
...
<body>
	<ul>
		<li id="apple">apple</li>
		<li id="banana">banana</li>
		<li id="orange">orange</li>
	</ul>
	
	<script>
		const $elem = document.getElementById('banana');
		$elem.style.color = 'red';
		
		// id가 존재하지 않을 경우 getELementById 메서드는 null 반환
		const $grape = document.getElementById('grape');
		console.log($grape); // null
	</script>
</body>
...
```

### 2. 태그 이름을 이용한 요소 노드 취득

- Document.prototype/Element.prototype.getElementsByTagName 특정 태그 요소 노드 탐색, 반환하는 메서드
- HTMLCollection 객체를 반환하며 이것은 유사 배열 객체이면서 이터러블이다.
- 배열로 변경 후 요소를 순환하여 내용, 스타일을 변경한다.
- 태그 이름을 갖는 요소가 없을 경우 빈  HTMLCollection 객체를 반환한다.

```html
...
<body>
	<ul id="fruits">
		<li>apple</li>
		<li>banana</li>
		<li>orange</li>
	</ul>
	
	<script>
		// Document.prototype.getElementsByTagName 사용
		// dom 전체에서 요소 노드를 탐색하여 반환
		const $elem = document.getElementsByTagName('li');
		[...$elem].forEach(elem => { elem.style.color = 'red'; })
		
		const $fruits = document.getElementById('fruits');
		// Element.prototype.getElementsByTagName 사용
		// ul#fruilt 요소의 자손 노드 중 li 태그인 요소를 모두 탐색하여 반환
		const $fruitsList = $fruits.getElementsByTagName('li');
	</script>
</body>
...
```

### 3. class를 이용한 요소 노드 취득

- Document.prototype/Element.prototype.getElementsByClassName 특정 class 어트리뷰트를 가진 요소 노드 탐색, 반환 하는 메서드
- 탐색된 요소 객체는 유사 배열 객체이면서 이터러블이다.
- 배열로 변경 후 요소를 순환하여 내용, 스타일을 변경한다.
- 해당 class를 갖는 요소가 없을 경우 빈  HTMLCollection 객체를 반환한다.

```html
...
<body>
	<ul>
		<li class="fruit apple">apple</li>
		<li class="fruit banana">banana</li>
		<li class="fruit orange">orange</li>
	</ul>
	
	<script>
		const $elems = document.getElementsByClassName('fruit');
		[...$elems].forEach(elem => { elem.style.color = 'red'; })
		
		// class가 fruit apple인 요소 HTMLCollection 객체에 담아 반환
		const $apples= document.getElementsByClassName('fruit apple');
		[...$apples].forEach(elem => { elem.style.color = 'blue'; })
	</script>
</body>
...
```

### 4. CSS 선택자를 이용한 요소 노드 취득

- Document.prototype/Element.prototype.querySelector 인수로 전달한 CSS 선택자를 만족하는 **하나의 요소 노드** 탐색, **반환** 하는 메서드
- CSS 선택자로 탐색된 요소 노드가 여러개일 경우 첫 번째 요소만 반환한다.
- CSS 선택자를 만족시키는 요소 노드가 없는 경우 null을 반환한다.
- CSS 선택자가 문법에 맞지 않는 경우 DOMException 에러가 발생한다.

```html
...
<body>
	<ul>
		<li class="apple">apple</li>
		<li class="banana">banana</li>
		<li class="orange">orange</li>
	</ul>
	
	<script>
		const $elem = document.querySelector('.banana');
		$elem.style.color = 'red';
	</script>
</body>
...
```

- Document.prototype.querySelectorAll / Element.prototype.querySelectorAll 로 CSS 선택자를 만족시키는 모든 요소를 탐색하여 반환한다.
- querySelectorAll 메서드는 NodeList 객체를 반환, 이것은 유사 배열 객체이면서 이터러블이다.
- **유사 배열이지만 `forEach()` 함수 적용이 가능하다.**
- getElementById, getElementsBy*** 메서드 보단 다소 느리다.

```html
...
<body>
	<ul>
		<li class="apple">apple</li>
		<li class="banana">banana</li>
		<li class="orange">orange</li>
	</ul>
	
	<script>
		const $elems = document.querySelectorAll('ul > li');
		$elems.forEach(elem => { elem.style.color = 'red'; })
	</script>
</body>
...
```

### 5. 특정 요소 노드를 취득할 수 있는지 확인

- Element.prototype.matches 메서드는 인수로 전달한 CSS 선택자를 통해 특정 요소 노드를 취득할 수 있는지 확인한다.

```html
...
<body>
	<ul id="fruits">
		<li class="apple">apple</li>
		<li class="banana">banana</li>
		<li class="orange">orange</li>
	</ul>
	
	<script>
		const $apple = document.querySelector('apple');
		// $apple 노드는 #fruits > li.apple 선택자로 취득할 수 있다.
		console.log($apple.matches('#fruits > li.apple)); // true
		
		// $apple 노드는 #fruits > li.banana 선택자로 취득할 수 없다.
		console.log($apple.matches('#fruits > li.banana)); // false
	</script>
</body>
...
```

### HTMLCollection과 NodeList

- 두 객체는 DOM 컬렉션 객체다.
- 두 객체는 유사 배열 객체면서 이터러블이다.(for … of문 순회 가능)
- 스프레드 문법 사용하여 배열로 변환 가능
- HTMLCollection - 노드 객체 상태 변화를 실시간으로 반영하는 **살아있는 객체**
- NodeList -  상태 변화를 실시간으로 반영하지 않는 non-live객체지만 경우에 따라 live객체로 동작

```html
...
<body>
	<ul id="fruits">
		<li class="red">apple</li>
		<li class="red">banana</li>
		<li class="red">orange</li>
	</ul>
	<script>
		const $elems= document.getElementsByClassName('red');
		
		// HTMLCollection 객체의 모든 요소의 class 값을 blue로 변경
		for(let i = 0; i < $elems.length; i ++) {
			elems[i].className = 'blue';
		}
		
		console.log($elems); // HTMLCollection(1) [li.red]
	</script>
</body>
...
```

<aside>
💡 노드 객체의 상태 변경과 상관없이 안전하게 DOM 컬렉션을 사용하려면 HTMLCollection이나 NodeList 객체를 배열로 변환하여 사용하는 것을 권장한다.

</aside>

## 노드 탐색

- DOM 트리 상의 노드를 탐색할 수 있도록 Node, Element 인터페이스는 트리 탐색 프로퍼티를 제공 한다.
- 모두 읽기 전용 접근자 프로퍼티다.

**공백 텍스트 노드**

- 공백 문자(스페이스, 탭, 줄바꿈)는 텍스트 노드를 생성한다.
- 노드를 탐색할 때는 공백 문자가 생성한 공백 텍스트 노드에 주의해야 한다.

### **자식 노드 탐색**

| 프로퍼티 | 설명 |
| --- | --- |
| Node.prototype.childNodes | 자식 노드 모두 탐색
NoeList 반환
 요소 노드 + 텍스트 노드 포함 |
| Element.prototype.children | 자식 노드 중 요소 노드만 모두 탐색
HTMLCollection 반환
요소 노드(텍스트 노드가 포함X) |
| Node.prototype.firstChild | 첫 번째 자식 노드 반환
텍스트 노드 이거나 요소 노드임 |
| Node.prototype.lastChild | 마지막 자식 노드 반환
텍스트 노드 이거나 요소 노드임 |
| Element.prototype.firstElementChild | 첫 번째 자식 요소 노드 반환
요소 노드만 반환됨 |
| Element.prototype.lastElementChild | 마지막 자식 요소 노드 반환
요소 노드만 반환됨 |

### 자식 노드 존재 확인

| 메서드 | 설명 |
| --- | --- |
| Node.prototype.hasChildNodes() | 텍스트 노드 포함 자식 노드가 존재하는지 확인
불리언 타입 반환 |
| Element.childElementCount() | 텍스트 노드가 아닌 요소 노드 존재 확인
수량 출력 |
| Element.children.length() | 텍스트 노드가 아닌 요소 노드 존재 확인
수량 출력 |

### 요소 노드의 텍스트 노드 탐색

- Element.prototype.firstChild 프로퍼티 사용

```html
...
<body>
	<div id="foo">안녕하세요</div>
	
<script>
console.log(document.getElementById('foo').firstChild)
</script>
</body>
...
```

### 부모 노드 탐색

- Node.prototype.parentNode 프로퍼티 사용

```html
...
<body>
	<ul id="fruits">
		<li class="apple">apple</li>
		<li class="banana">banana</li>
		<li class="orange">orange</li>
	</ul>
	<script>
		const $banana= document.querySelector('banana');
		// .banana 요소 노드의 부모 노드 탐색
		console.log($banana.parentNode); // ul#fruits
	</script>
</body>
...
```

### 형제 노드 탐색

| 프로퍼티 | 설명 |
| --- | --- |
| Node.prototype.previousSibling | 형제노드 중 자신의 이전 형제 노드 반환
요소 노드 혹은 텍스트 노드 |
| Node.prototype.nextSibling | 형제노드 중 자신의 다음 형제 노드 반환
요소 노드 혹은 텍스트 노드 |
| Element.prototype.previousElementSibling | 형제노드 중 자신의 이전 형제 노드 반환
요소 노드만 반환 |
| Element.prototype.nextElementSibling | 형제노드 중 자신의 다음 형제 노드 반환
요소 노드만 반환 |
